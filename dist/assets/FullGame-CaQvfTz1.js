var Rt=Object.defineProperty;var Dt=(n,t,i)=>t in n?Rt(n,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[t]=i;var e=(n,t,i)=>(Dt(n,typeof t!="symbol"?t+"":t,i),i);import{C as r,_ as V,o as w,c as y,r as Ct,d as E,a as Ft,w as J,F as G,b as o,e as _t,u as v,t as D,f as kt,g as A,h as x,i as It,j as Lt,k as M,n as Mt,p as Ht,l as Ot}from"./index-BBO_VQ6H.js";const Tt="/assets/spirit-Hj0wSrEj.mp3";class U{constructor(t){e(this,"ctx");this.ctx=t}drawSprite({image:t,sx:i,sy:s,sw:a,sh:h,dx:c,dy:p,dw:d,dh:I}){this.ctx.drawImage(t,i,s,a,h,c,p,d,I)}drawImage(t,{x:i,y:s,width:a,height:h}){this.ctx.drawImage(t,i,s,a,h)}}class u{constructor(t,i){e(this,"x");e(this,"y");this.x=t,this.y=i}}function At({x:n,y:t,width:i},s){let a=n;return n<=-i&&(a=0),a=Math.floor(a-s),{x:a,y:t}}const Et="/assets/bg1-BlLRAQpK.png",Wt="/assets/bg2-xP97U8q-.png",$t="/assets/bg3-CWqdUxfu.png";class m{constructor(t){e(this,"timeSinceUpdate",0);e(this,"updateInterval");this.updateInterval=t}onUpdate(t,i){this.timeSinceUpdate+=t,this.timeSinceUpdate>this.updateInterval&&(this.timeSinceUpdate=0,i())}}function H(n,t){const i=new Image;return i.src=n,{img:i,speedModifier:t}}const Bt=[H($t,.4),H(Wt,.6),H(Et,.8)],Gt=Bt;class Ut{constructor(t,i,s){e(this,"game");e(this,"image");e(this,"position");e(this,"speed");e(this,"backgroundSpeed");e(this,"layerSpeed");e(this,"speedModifier");e(this,"frameRate");this.game=t,this.image=i,this.position=new u(0,0),this.frameRate=new m(r.frameRate),this.backgroundSpeed=25,this.speedModifier=s,this.layerSpeed=this.backgroundSpeed*this.speedModifier,this.speed=0}get width(){return this.game.ctx.canvas.width}get height(){return this.game.ctx.canvas.height}get coordinates(){return this.computeCoordinates(0)}get leftCoordinates(){return this.computeCoordinates(-this.width)}get rightCoordinates(){return this.computeCoordinates(this.width)}computeCoordinates(t){return{x:this.position.x+t,y:this.position.y,width:this.width,height:this.height}}update(t,i){i.moveRight()?this.speed=this.layerSpeed:i.moveLeft()?this.speed=-this.layerSpeed:this.speed=0,this.frameRate.onUpdate(t,()=>{this.position=At(this.coordinates,this.speed)})}draw(){this.game.drawer.drawImage(this.image,this.leftCoordinates),this.game.drawer.drawImage(this.image,this.coordinates),this.game.drawer.drawImage(this.image,this.rightCoordinates)}get mustDelete(){return!1}}class Pt{constructor(t){e(this,"game");e(this,"position");e(this,"width");e(this,"height");e(this,"speed");e(this,"backgroundSpeed");e(this,"frameRate");this.game=t,this.width=t.ctx.canvas.width,this.height=t.ctx.canvas.height,this.position=new u(0,0),this.frameRate=new m(r.frameRate),this.backgroundSpeed=25,this.speed=0}get coordinates(){return{x:this.position.x,y:this.position.y,width:this.width,height:this.height}}update(t,i){i.moveRight()?this.speed=this.backgroundSpeed:i.moveLeft()?this.speed=-this.backgroundSpeed:this.speed=0,this.frameRate.onUpdate(t,()=>{this.position={x:Math.floor(this.position.x-this.speed),y:this.position.y}})}shouldStopMove(t){return this.shouldStopMovingLeft(t)||this.shouldStopMovingRight(t)}shouldStopMovingLeft(t){return t.moveLeft()&&this.leftLimitReached}shouldStopMovingRight(t){return t.moveRight()&&this.rightLimitReached}get leftLimitReached(){return this.position.x>=this.width}get rightLimitReached(){return this.position.x<=-this.width}}class Xt{constructor(t){e(this,"game");e(this,"layers");e(this,"limit");this.game=t,this.layers=Gt.map(({img:i,speedModifier:s})=>new Ut(t,i,s)),this.limit=new Pt(t)}get mustDelete(){return!1}get opossumLayer(){return this.layers[this.layers.length-1]}get coordinate(){return this.opossumLayer.coordinates}get speed(){return this.opossumLayer.layerSpeed}update(t,i){this.layers.forEach(s=>s.update(t,i)),this.limit.update(t,i)}draw(){this.layers.forEach(t=>t.draw())}}class k{constructor(t,i,s,a=1){e(this,"row");e(this,"frameCount");e(this,"turn");e(this,"startFrame");e(this,"frame");e(this,"right",!0);this.row=t,this.frameCount=i,this.startFrame=s,this.frame=s,this.turn=a}update(){return this.frame>=this.frameCount-1?this.right=!1:this.frame<=0&&(this.turn--,this.right=!0),this.right?this.frame++:this.frame--,{row:this.row,frame:this.frame}}isFinished(){return this.turn<=0&&this.frame==this.startFrame}}const Q="/assets/Opossum1Sprite-h-Xbui9z.png",Z=new Image;Z.src=Q;const Kt={img:Q,image:Z,colWidth:1500,rowHeight:1500,states:[{name:"balance",frames:7},{name:"eyes",frames:5}]};class g{constructor(t,{row:i,frame:s}){e(this,"sprite");e(this,"currentRow");e(this,"currentFrame");this.sprite=t,this.currentRow=i,this.currentFrame=s}stateFor(t){return this.sprite.states.find(({name:i})=>i===t)}selectState(t){this.currentRow=this.rowFor(t),this.currentFrame=0}rowFor(t){return this.sprite.states.indexOf(this.stateFor(t))}get frameCount(){return this.sprite.states[this.row].frames}get isLastFrame(){return this.frame>=this.frameCount-1}get isFirstFrame(){return this.frame<=0}get sw(){return this.sprite.colWidth}get sh(){return this.sprite.rowHeight}get row(){return this.currentRow}get frame(){return this.currentFrame}animate(t){this.currentFrame=t}update({row:t,frame:i}){this.currentRow=t,this.currentFrame=i}toDrawRef(t){return{image:this.sprite.image,sx:this.currentFrame*this.sprite.colWidth,sy:this.currentRow*this.sprite.rowHeight,sw:this.sprite.colWidth,sh:this.sprite.rowHeight,dx:t.x,dy:t.y,dw:t.width,dh:t.height}}}class zt{constructor(t){e(this,"randomColors");e(this,"color");e(this,"collisionCtx");const i=Math.floor(Math.random()*255),s=Math.floor(Math.random()*255),a=Math.floor(Math.random()*255);this.randomColors=[i,s,a],this.color=`rgb(${i},${s},${a})`,this.collisionCtx=t}isHit([t,i,s]){const[a,h,c]=this.randomColors;return a===t&&h===i&&c===s}draw({x:t,y:i,width:s,height:a}){this.collisionCtx.fillStyle=this.color,this.collisionCtx.fillRect(t,i,s,a)}}const Nt=`Dans tous les cas,
ça bascule.
ça roule aussi,
ça tangue,
ça hésite,
ça chancelle,
ça titube, mais
ça ne tombe pas
Non,
jamais.`,tt=Nt.split(`
`).filter(n=>n.length>0);let F=-1;function Yt(){return F++,F>=tt.length&&(F=0),F}function jt(n,t=1){const i=Math.round(n.length/t),s=[];let a=0;for(const h of n.split(" ").filter(c=>c.length>0))s[a]=(s[a]||"")+h+" ",s[a].length>=i&&a<t&&a++;return s.map(h=>h.trim())}function qt(n=2){return jt(tt[Yt()])}class W{constructor(t,i,s,a){e(this,"game");e(this,"sprite");e(this,"position");e(this,"initialPosition");e(this,"speed");e(this,"markedForDeletion");e(this,"layerSpeed");e(this,"movementRate");e(this,"frameRate");e(this,"collisionDetection");e(this,"lines");e(this,"initialXShift");e(this,"initialYShift");this.game=t,this.sprite=i,this.initialXShift=s,this.initialYShift=a,this.initialPosition=this.computeInitialPosition(),this.position=this.initialPosition,this.lines=qt(),this.speed=0,this.markedForDeletion=!1,this.layerSpeed=t.background.speed,this.movementRate=new m(50),this.frameRate=new m(r.frameRate*1.66),this.collisionDetection=new zt(t.collisionCtx),window.addEventListener("game-resized",()=>this.resetInitialPosition())}resetInitialPosition(){this.initialPosition=this.computeInitialPosition()}computeInitialPosition(){const t=this.game.ctx.canvas.width*(this.initialXShift/1920),i=this.game.ctx.canvas.height*(this.initialYShift/937);return new u(this.game.ctx.canvas.width/2+t,this.game.ctx.canvas.height/2+i)}get xAcceleration(){return this.game.ch(r.playerXSpeedScale)}get width(){return this.sprite.sw*this.height/this.sprite.sh}get height(){return this.game.ch(r.opossumScale)}get mustDelete(){return this.markedForDeletion}get coordinate(){return{x:this.position.x,y:this.position.y,width:this.width,height:this.height}}fire(t){return this.collisionDetection.isHit(t)?(this.markedForDeletion=!0,!0):!1}update(t,i){this.movementRate.onUpdate(t,()=>{const s=this.game.background.coordinate;this.position={x:this.initialPosition.x+s.x,y:this.initialPosition.y+s.y}}),this.frameRate.onUpdate(t,()=>{this.sprite.update(this.nextFrame(i))})}draw(){this.collisionDetection.draw(this.coordinate),this.game.drawer.drawSprite(this.sprite.toDrawRef(this.coordinate))}}class ${constructor(t){e(this,"animations");e(this,"currentAnimation");e(this,"selectedAnimation",0);this.animations=t,this.currentAnimation=this.animations[this.selectedAnimation]()}isFinished(){return!1}update(t){return this.currentAnimation.isFinished()&&this.switchAnimation(),this.currentAnimation.update(t)}switchAnimation(){this.currentAnimation=this.animations[this.nextAnimation()]()}nextAnimation(){return this.selectedAnimation>=this.animations.length-1?this.selectedAnimation=0:this.selectedAnimation++,this.selectedAnimation}}class P extends W{constructor(i,s,a){super(i,new g(Kt,{row:0,frame:3}),s,a);e(this,"animation");this.animation=new $([()=>new k(0,7,3,4),()=>new k(1,5,0,2)])}nextFrame(i){return this.animation.update(i)}}const et="/assets/Opossum2Sprite-4rX3k2Xd.png",it=new Image;it.src=et;const Vt={img:et,image:it,colWidth:1500,rowHeight:1500,states:[{name:"balance",frames:7},{name:"eyes",frames:5}]};class X extends W{constructor(i,s,a){super(i,new g(Vt,{row:0,frame:3}),s,a);e(this,"animation");this.animation=new $([()=>new k(0,7,3,6),()=>new k(1,5,0,2)])}nextFrame(i){return this.animation.update(i)}}const st="/assets/Opossum3Sprite-DtO4J89q.png",at=new Image;at.src=st;const Jt={img:st,image:at,colWidth:1500,rowHeight:1500,states:[{name:"eyes",frames:7}]};class K extends W{constructor(i,s,a){super(i,new g(Jt,{row:0,frame:3}),s,a);e(this,"leftDirection");e(this,"frame",3);this.leftDirection=!1}nextFrame(){return this.sprite.isFirstFrame&&(this.leftDirection=!1),this.sprite.isLastFrame&&(this.leftDirection=!0),this.leftDirection?this.frame--:this.frame++,{row:this.sprite.row,frame:this.frame}}}const B="/assets/speech3-D6q3FM4G.png",nt="/assets/liquid-B2Ob5p8Y.wav",rt="/assets/SpriteCloud-BuNlbzgr.png",ht=new Image;ht.src=rt;const ot={img:rt,image:ht,colWidth:300,rowHeight:230,states:[{name:"normal",frames:9}]},ct=new Image;ct.src=B;const z="black";class Qt{constructor(t,i,s){e(this,"game");e(this,"textLines");e(this,"source");e(this,"bubbleImageWidth",656);e(this,"bubbleImageHeight",520);e(this,"lineHeight",40);e(this,"widthTextMargin",250);this.game=t,this.textLines=i,this.source=s}get maxTextWidth(){this.game.ctx.font=this.font,this.game.ctx.fillStyle=z;let t=0;for(const i of this.textLines)t=Math.max(t,this.game.ctx.measureText(i).width);return t}get font(){const i=screen.orientation.type.indexOf("landscape")>-1?"(max-height: 768px)":"(max-width: 768px)";return window.matchMedia(i).matches?"5vh julien":"3.4vh julien"}get position(){const t=this.source.coordinate;return new u(t.x,t.y)}get bubbleWidth(){return this.maxTextWidth+this.widthTextMargin}draw(){this.game.ctx.font=this.font,this.game.ctx.fillStyle=z;const t=this.textLines.length,i=this.bubbleWidth,s=t*this.lineHeight+this.lineHeight;this.game.ctx.drawImage(ct,0,0,this.bubbleImageWidth,this.bubbleImageHeight,this.position.x,this.position.y,i,s),this.textLines.forEach(a=>{const h=this.game.ctx.measureText(a).width,c=this.position.x+(i-h)/2,p=this.position.y+this.lineHeight*this.textLines.indexOf(a)+this.lineHeight+5;this.game.ctx.fillText(a,c,p)})}}new Audio(nt);const Zt=new Image;Zt.src=B;class te{constructor(t,i,s,a=!1){e(this,"game");e(this,"sprite");e(this,"size");e(this,"frame");e(this,"markedForDeletion");e(this,"fixed");e(this,"frameRate");e(this,"quoteDurationSeconds",4);e(this,"creationTime");e(this,"displayBubble",!1);e(this,"source");e(this,"bubbleText");this.game=t,this.sprite=new g(ot,{row:0,frame:0}),this.size=s,this.source=i,this.size=s,this.frame=0,this.markedForDeletion=!1,this.fixed=a,this.frameRate=new m(r.frameRate),this.creationTime=new Date().getTime(),this.bubbleText=new Qt(t,i.lines,this)}get coordinate(){return{x:this.x,y:this.y,width:this.size,height:this.size}}get x(){return this.source.coordinate.x}get y(){return this.source.coordinate.y}get mustDelete(){return this.markedForDeletion&&!this.fixed}update(t){this.frame,this.frameRate.onUpdate(t,()=>{this.displayBubble?(new Date().getTime()-this.creationTime)/1e3>this.quoteDurationSeconds&&!this.fixed&&(this.displayBubble=!1,this.frame++):this.frame>this.sprite.frameCount-2?this.markedForDeletion=!0:this.frame==4?this.displayBubble=!0:this.frame++,this.sprite.update({row:0,frame:this.frame})})}draw(){this.displayBubble?this.bubbleText.draw():this.game.drawer.drawSprite(this.sprite.toDrawRef(this.coordinate))}}const mt="/assets/NikoMovementPartial-DkIKTc0W.png",dt=new Image;dt.src=mt;const S={img:mt,image:dt,colWidth:900,rowHeight:900,states:[{name:"mouth",frames:3},{name:"arms",frames:4},{name:"legs",frames:3},{name:"head-up",frames:5},{name:"head-left",frames:5},{name:"head-right",frames:5}]};S.colWidth*4,S.rowHeight*0;const ee={row:0,frame:4};class lt{constructor(t,i,s=!1,a=0){e(this,"movingElement");e(this,"maxFrame");e(this,"horizontal");e(this,"row");e(this,"previousSpeed");e(this,"frame");this.movingElement=t,this.maxFrame=i,this.horizontal=s,this.previousSpeed=0,this.frame=0,this.row=a}isFinished(){return!1}update(t){const{xSpeed:i,ySpeed:s}=this.movingElement.movement;return(this.horizontal?i:s)>=0?this.frame=Math.max(this.frame-1,0):this.frame=Math.min(this.frame+1,this.maxFrame-1),{row:this.row,frame:this.frame}}}class ie{constructor(t,i){e(this,"game");e(this,"parent");e(this,"sprite");e(this,"frameRate");e(this,"animation");e(this,"mustDelete",!1);e(this,"source");this.game=t,this.parent=i,this.sprite=new g(S,{row:1,frame:0}),this.frameRate=new m(r.frameRate*r.playerFrameRateModifier),this.animation=new lt(i,this.sprite.frameCount,!1,this.sprite.row)}get coordinate(){return this.parent.coordinate}update(t,i){this.frameRate.onUpdate(t,()=>{this.sprite.update(this.animation.update(i))})}draw(){this.game.drawer.drawSprite(this.sprite.toDrawRef(this.coordinate))}}class se{constructor(t,i){e(this,"game");e(this,"parent");e(this,"sprite");e(this,"frameRate");e(this,"animation");e(this,"mustDelete",!1);e(this,"source");this.game=t,this.parent=i,this.sprite=new g(S,{row:2,frame:0}),this.frameRate=new m(r.frameRate*r.playerFrameRateModifier),this.animation=new lt(i,this.sprite.frameCount,!1,this.sprite.row)}get coordinate(){return this.parent.coordinate}update(t,i){this.frameRate.onUpdate(t,()=>{this.sprite.update(this.animation.update(i))})}draw(){this.game.drawer.drawSprite(this.sprite.toDrawRef(this.coordinate))}}class _{constructor(t,i=0,s=0){e(this,"totalFrame");e(this,"frame");e(this,"increment");e(this,"row");e(this,"started");this.totalFrame=t,this.frame=s,this.increment=1,this.row=i,this.started=!1}isFinished(){return this.frame===0&&this.started}update(){return this.started=!0,this.frame+=this.increment,(this.frame>=this.totalFrame-1||this.frame<=0)&&(this.increment=-this.increment),{row:this.row,frame:this.frame}}}class O{constructor(t=5,i=0,s=0){e(this,"row");e(this,"frame");e(this,"countdown");this.row=i,this.frame=s,this.countdown=t}isFinished(){return this.countdown<=0}update(t){return this.countdown--,{row:this.row,frame:this.frame}}}function C(n,t){return Math.floor(Math.random()*(t-n+1)+n)}function T(n,t){return C(n*101,t*101)/101}function ae(n,t,i,s,a,h){return new u(n+i/2-a/2,t+s/2-h/2)}function b(n){return new ne(n)}class ne{constructor(t){e(this,"animation");e(this,"pointer");this.animation=t}isFinished(){return this.animation.isFinished()}shouldUpdate(){return C(1,3)>=2}update(t){return(!this.pointer||this.shouldUpdate())&&(this.pointer=this.animation.update(t)),this.pointer}}class re{constructor(t,i){e(this,"game");e(this,"parent");e(this,"sprite");e(this,"frameRate");e(this,"animation");e(this,"mustDelete",!1);this.game=t,this.parent=i,this.sprite=new g(S,{row:3,frame:0}),this.frameRate=new m(r.frameRate*r.playerFrameRateModifier),this.animation=new $([()=>b(new _(3,0)),()=>b(new O(5)),()=>b(new _(5,4)),()=>b(new O(2)),()=>b(new _(5,3)),()=>b(new O(7)),()=>b(new _(5,5))])}get coordinate(){return this.parent.coordinate}update(t,i){this.frameRate.onUpdate(t,()=>{this.sprite.update(this.animation.update(i))})}draw(){this.game.drawer.drawSprite(this.sprite.toDrawRef(this.coordinate))}}const ut="/assets/bubbles-CY0KWS_b.png",pt=new Image;pt.src=ut;const N={img:ut,image:pt,colWidth:256,rowHeight:256,states:[{name:"bubble",frames:7}]};function he(n){return C(0,n.frames)}function oe({x:n,y:t},i=30){return new u(n+C(-i,i),t+C(-i,i))}class ce{constructor(t,{x:i,y:s,width:a,height:h}){e(this,"game");e(this,"sprite");e(this,"duration");e(this,"position");e(this,"frameRate");e(this,"width");e(this,"speedX");e(this,"speedY");this.frameRate=new m(r.frameRate*r.playerFrameRateModifier),this.game=t,this.sprite=new g(N,{row:0,frame:he(N.states[0])}),this.duration=15,this.width=a*T(.1,.3),this.speedX=t.ch(T(-r.bubbleSpeedScale,r.bubbleSpeedScale)),this.speedY=t.ch(T(-r.bubbleSpeedScale,r.bubbleSpeedScale)),this.position=oe(ae(i,s,a,h,this.width,this.height))}get height(){return this.sprite.sh*this.width/this.sprite.sw}get coordinate(){return{x:this.position.x,y:this.position.y,width:this.width,height:this.height}}update(t,i){this.frameRate.onUpdate(t,()=>{this.duration--,this.position=new u(this.position.x+this.speedX,this.position.y+this.speedY)})}draw(){this.game.drawer.drawSprite(this.sprite.toDrawRef(this.coordinate))}get mustDelete(){return this.duration<=0}}class me{constructor(t){e(this,"game");e(this,"position");e(this,"body");e(this,"movement");e(this,"frameRate");e(this,"arms");e(this,"legs");e(this,"head");e(this,"bubbles",[]);this.game=t,this.body=new g(S,ee),this.position=t.center(this.width,this.height),this.movement={xSpeed:0,ySpeed:0},this.frameRate=new m(r.frameRate*r.playerFrameRateModifier),this.arms=new ie(t,this),this.legs=new se(t,this),this.head=new re(t,this)}get maxXSpeed(){return this.game.ch(r.playerXSpeedScale)}get maxYSpeed(){return this.game.cw(r.playerYSpeedScale)}get weight(){return this.game.ch(r.gravityScale)}get width(){return this.body.sw*this.height/this.body.sh}get height(){return this.game.ch(r.playerScale)}computeSpeed(t,i){let{xSpeed:s,ySpeed:a}=i;return t.moveRight()?s=Math.min(s+1,this.maxXSpeed):t.moveLeft()?s=Math.max(s-1,-this.maxXSpeed):s>0?s=Math.max(s-1,0):s=Math.min(s+1,0),t.moveUp()?a-=this.maxYSpeed:t.moveDown()?a+=this.maxYSpeed:a=0,a=this.applyGravity(a),{xSpeed:s,ySpeed:a}}update(t,i){this.bubbles=this.bubbles.filter(s=>!s.mustDelete),this.bubbles.push(new ce(this.game,this.coordinate)),this.frameRate.onUpdate(t,()=>{this.movement=this.computeSpeed(i,this.movement),this.position=this.newPosition(this.movement),this.arms.update(t,i),this.legs.update(t,i),this.head.update(t,i),this.bubbles.forEach(s=>s.update(t,i))})}applyGravity(t){return this.onGround?t:t+this.weight}newPosition({xSpeed:t,ySpeed:i}){let s=Math.min(this.position.x+t),a=this.position.y+i;return new u(Math.min(Math.max(s,0),this.rightBoundary),Math.min(Math.max(a,0),this.groundHeight))}get rightBoundary(){return this.game.ctx.canvas.width-this.width}get groundHeight(){return this.game.ctx.canvas.height-this.height}get onGround(){return this.position.y>=this.groundHeight}get coordinate(){return{x:this.position.x,y:this.position.y,width:this.width,height:this.height}}draw(){this.bubbles.forEach(t=>t.draw()),this.game.drawer.drawSprite(this.body.toDrawRef(this.coordinate)),this.arms.draw(),this.legs.draw(),this.head.draw()}get mustDelete(){return!1}}const gt="/assets/fumigene-BeRSvuK_.png",ft=new Image;ft.src=B;const Y="3.2vh julien",j="black";class de{constructor(t){e(this,"game");e(this,"textLines");e(this,"sprite");e(this,"bubbleImageWidth",656);e(this,"bubbleImageHeight",520);e(this,"lineHeight",60);e(this,"widthTextMargin",250);e(this,"frameRate");e(this,"width");e(this,"height");e(this,"position");e(this,"frame",0);e(this,"mustDelete",!1);this.game=t,this.sprite=new g(ot,{row:0,frame:0}),this.textLines=[],this.frameRate=new m(r.frameRate),this.width=this.bubbleWidth,this.height=this.bubbleHeight,this.position=this.game.center(this.width,this.height)}get maxTextWidth(){this.game.ctx.font=Y,this.game.ctx.fillStyle=j;let t=0;for(const i of this.textLines)t=Math.max(t,this.game.ctx.measureText(i).width);return t}get bubbleWidth(){return this.maxTextWidth+this.widthTextMargin}get bubbleHeight(){return this.textLines.length*this.lineHeight+2*this.lineHeight}get coordinate(){return{x:this.position.x,y:this.position.y,width:this.width,height:this.height}}update(t){this.frameRate.onUpdate(t,()=>{this.frame<=4&&this.frame++,this.sprite.update({row:0,frame:this.frame})})}draw(){if(this.frame<4)this.game.drawer.drawSprite(this.sprite.toDrawRef(this.coordinate));else{console.log("draw text and image"),this.game.ctx.font=Y,this.game.ctx.fillStyle=j;const t=this.position;this.game.ctx.drawImage(ft,0,0,this.bubbleImageWidth,this.bubbleImageHeight,t.x,t.y,this.width,this.height),this.textLines.forEach(i=>{const s=this.game.ctx.measureText(i).width,a=t.x+(this.width-s)/2,h=t.y+this.lineHeight*this.textLines.indexOf(i)+this.lineHeight*2;this.game.ctx.fillText(i,a,h)})}}}new Audio(nt);const wt=new Image;wt.src=gt;const le={img:gt,image:wt,colWidth:500,rowHeight:800,states:[{name:"standard",frames:7}]};class ue{constructor(t,i){e(this,"game");e(this,"sprite");e(this,"initialX");e(this,"position");e(this,"scale");e(this,"frame");e(this,"movementRate");e(this,"frameRate");e(this,"scaleRate");e(this,"layerSpeed");e(this,"speed");e(this,"mustDelete",!1);e(this,"scaleIncrement",.02);e(this,"bubbleText");this.game=t,this.sprite=new g(le,{row:0,frame:0}),this.initialX=i,this.scale=this.scaleIncrement,this.position=new u(i,this.y),this.frame=0,this.layerSpeed=t.background.speed*r.fumigeneSpeedModifier,this.speed=0,this.movementRate=new m(50),this.frameRate=new m(r.frameRate*1.1),this.scaleRate=new m(30),this.bubbleText=new de(this.game)}get width(){return this.sprite.sw*this.scale}get height(){return this.sprite.sh*this.scale}get x(){return this.game.center(this.width,this.height).x}get y(){return this.game.ctx.canvas.height-this.height+this.scale*this.sprite.sh*.05}get coordinate(){return{x:this.x,y:this.y,width:this.width,height:this.height}}update(t,i){this.frame,this.scaleRate.onUpdate(t,()=>{this.scale<1.6?(this.scale+=this.scaleIncrement,this.position=new u(this.position.x,this.y)):(this.bubbleText.update(t),this.mustDelete=!0)}),this.movementRate.onUpdate(t,()=>{i.moveLeft()?this.speed=-this.layerSpeed:i.moveRight()?this.speed=this.layerSpeed:this.speed=0,this.position=new u(this.position.x+this.speed,this.position.y)}),this.frameRate.onUpdate(t,()=>{this.frame++,this.frame>this.sprite.frameCount&&(this.frame=0),this.sprite.update({row:0,frame:this.frame})})}draw(){this.mustDelete||this.game.drawer.drawSprite(this.sprite.toDrawRef(this.coordinate))}}class pe{constructor(){e(this,"maxPuppet",10);e(this,"puppetMissThreshold",3);e(this,"puppetInterval",500);e(this,"missedPuppet",0);e(this,"currentScore",0);e(this,"timeToNextPuppet",0)}win(t){this.currentScore+=t}get score(){return this.currentScore}get isGameOver(){return!1}miss(){this.missedPuppet++}shouldAddPuppet(t,i){return this.timeToNextPuppet+=t,this.timeToNextPuppet>this.puppetInterval&&i<this.maxPuppet&&(this.timeToNextPuppet=0),!1}}class ge{constructor(){e(this,"supportedKeys",["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"]);e(this,"keys",[]);e(this,"touchX");e(this,"touchY");e(this,"touchThreshold",30);this.touchX=-1,this.touchY=-1,window.addEventListener("keydown",({key:t})=>{this.supportedKeys.includes(t)&&!this.hasKey(t)&&this.keys.push(t)}),window.addEventListener("keyup",({key:t})=>{this.supportedKeys.includes(t)&&this.removeKey(t)}),window.addEventListener("touchstart",t=>{this.touchX=t.changedTouches[0].pageX,this.touchY=t.changedTouches[0].pageY}),window.addEventListener("touchmove",t=>{const i=t.changedTouches[0].pageY-this.touchY;i<-this.touchThreshold&&!this.hasKey("SwipeUp")?this.keys.push("SwipeUp"):i>this.touchThreshold&&!this.hasKey("SwipeDown")&&this.keys.push("SwipeDown");const s=t.changedTouches[0].pageX-this.touchX;s<-this.touchThreshold&&!this.hasKey("SwipeLeft")?this.keys.push("SwipeLeft"):s>this.touchThreshold&&!this.hasKey("SwipeRight")&&this.keys.push("SwipeRight")}),window.addEventListener("touchend",t=>{this.removeKey("SwipeUp"),this.removeKey("SwipeDown"),this.removeKey("SwipeLeft"),this.removeKey("SwipeRight")})}removeKey(t){this.keys.splice(this.keys.indexOf(t),1)}hasKey(t){return this.keys.includes(t)}hasOneOf(...t){return this.keys.some(i=>t.includes(i))}moveLeft(){return this.hasOneOf(...r.leftKeys)}moveRight(){return this.hasOneOf(...r.rightKeys)}moveUp(){return this.hasOneOf(...r.upKeys)}moveDown(){return this.hasOneOf(...r.downKeys)}}class q{constructor(t,i){e(this,"drawer");e(this,"collisionDrawer");e(this,"opossums",[]);e(this,"animations",[]);e(this,"fumigenes",[]);e(this,"player");e(this,"background");e(this,"level",new pe);e(this,"input");e(this,"started",new Date().getTime());this.drawer=new U(t),this.collisionDrawer=new U(i),this.input=new ge,this.player=new me(this),this.background=new Xt(this),this.ctx.font="50px Impact",window.addEventListener("resize",()=>this.computeCanvasWidth()),window.addEventListener("orientationchange",()=>this.computeCanvasWidth()),setTimeout(()=>this.computeCanvasWidth(),200)}computeCanvasWidth(){const t=window.innerWidth,i=t*(9/16);this.ctx.canvas.width=t,this.ctx.canvas.height=i,this.collisionCtx.canvas.width=t,this.collisionCtx.canvas.height=i,window.dispatchEvent(new CustomEvent("game-resized",{}))}async start(){await this.toggleFullScreen();let t=1;const i=this;function s(a){i.ctx.clearRect(0,0,i.ctx.canvas.width,i.ctx.canvas.height),i.collisionCtx.clearRect(0,0,i.ctx.canvas.width,i.ctx.canvas.height);const h=a-t;t=a,i.update(h),i.draw(),i.isGameOver?window.dispatchEvent(new CustomEvent("game-ended",{})):requestAnimationFrame(s)}s(0)}miss(){this.level.miss()}get drawOrder(){return[this.background,...this.opossums,this.player,...this.animations,...this.fumigenes]}get envObjects(){return[this.background,...this.opossums,...this.animations]}get allObjects(){return[...this.envObjects,this.player]}addAnimation(t){this.animations.push(t)}get shouldFinishGame(){return(new Date().getTime()-this.started)/1e3>r.gameDuration}get isGameDone(){var t;return this.shouldFinishGame&&!!((t=this.fumigenes[0])!=null&&t.mustDelete)}update(t){this.animations=this.animations.filter(i=>!i.mustDelete),this.fumigenes.length==0&&this.shouldFinishGame&&this.fumigenes.push(new ue(this,0)),this.opossums.length==0&&(this.opossums.push(new P(this,738,-100)),this.opossums.push(new X(this,-172,-300)),this.opossums.push(new K(this,-724,200)),this.opossums.push(new P(this,-1657,-350)),this.opossums.push(new X(this,-2088,150)),this.opossums.push(new K(this,1680,-400))),this.opossums.forEach(i=>{const s=i.coordinate,a=this.player.coordinate;a.x>s.x+s.width||a.x+a.width<s.x||a.y>s.y+s.height||a.y+a.height<s.y||this.animations.some(h=>h.source===i)||this.addAnimation(new te(this,i,300,!0))}),!this.background.limit.shouldStopMove(this.input)&&!this.isGameDone&&this.envObjects.forEach(i=>i.update(t,this.input)),this.player.update(t,this.input),this.fumigenes.forEach(i=>i.update(t,this.input))}draw(){if(this.level.isGameOver){this.drawGameOver();return}if(this.isGameDone){this.background.draw(),this.fumigenes.forEach(t=>t.draw());return}this.drawOrder.forEach(t=>t.draw())}get isGameOver(){return this.level.isGameOver||this.isGameDone}get ctx(){return this.drawer.ctx}get collisionCtx(){return this.collisionDrawer.ctx}cw(t){return this.ctx.canvas.width*t}ch(t){return this.ctx.canvas.height*t}center(t,i){return new u(this.ctx.canvas.width/2-t/2,this.ctx.canvas.height/2-i/2)}drawScore(){this.ctx.fillStyle="white",this.ctx.fillText("Score: "+this.level.score,50,75)}drawGameOver(){this.ctx.textAlign="center",this.ctx.fillStyle="white",this.ctx.fillText(`GAME OVER, your score is ${this.level.score}`,this.ctx.canvas.width/2,this.ctx.canvas.height/2)}async toggleFullScreen(){if(!document.fullscreenElement)try{await this.ctx.canvas.parentElement.requestFullscreen()}catch(t){console.error("Not able to enable full screen",t)}}}const fe=[{from:"2023-07-21",to:"2023-08-06",event:"Test",location:"Vuadens",country:"CH",link:"https://cchar.ch/"},{from:"2024-07-21",to:"2024-08-06",event:"CCHAR",location:"La Chaux-de-Fonds",country:"CH",link:"https://cchar.ch/"},{from:"2024-08-07",to:"2024-08-08",event:"Festival des  Six Pompes",location:"La Chaux-de-Fonds",country:"CH",link:"https://laplage.ch/"},{from:"2024-08-24",to:"2024-08-25",event:"Festival Hérisson sous Gazon",location:"Charrat",country:"CH",link:"https://herisson-sous-gazon.ch/"}],we={},xe={class:"op-agenda"};function be(n,t){return w(),y("div",xe,[Ct(n.$slots,"default",{},void 0,!0)])}const xt=V(we,[["render",be],["__scopeId","data-v-42131592"]]),ve=o("li",{class:"title"}," En manque d'Opossum ? ",-1),ye=["href"],Se=o("div",{class:"op-agenda"},null,-1),Re=E({__name:"Agenda",emits:["restart"],setup(n,{emit:t}){const i=t;function s(){i("restart")}const a={year:"numeric",month:"long",day:"numeric"},h=fe.filter(c=>{const p=new Date(c.to);return new Date().getTime()<p.getTime()}).map(c=>({...c,from:new Date(c.from).toLocaleDateString(void 0,a),to:new Date(c.to).toLocaleDateString(void 0,a)}));return(c,p)=>(w(),y(G,null,[Ft(xt,null,{default:J(()=>[o("ul",null,[ve,(w(!0),y(G,null,_t(v(h),d=>(w(),y("li",{key:d.event},[o("p",null,"du "+D(d.from)+" au "+D(d.to),1),o("a",{href:d.link,target:"_blank"},D(d.event),9,ye),kt(" à "+D(d.location)+" "+D(d.country),1)]))),128)),o("li",null,[o("button",{onClick:s},"Pas eu assez ?")])])]),_:1}),Se],64))}}),De=o("li",{class:"title"}," Viens à notre rencontre ! ",-1),Ce=o("li",null," Oriente ton téléphone en mode paysage. ",-1),Fe=o("li",null," Chatouille Niko avec ton pouce. ",-1),_e=o("li",null," Rends visite aux Opossums. ",-1),ke=E({__name:"GameInfo",emits:["start"],setup(n,{emit:t}){const i=t;function s(){i("start")}return(a,h)=>(w(),A(xt,null,{default:J(()=>[o("ul",null,[De,Ce,Fe,_e,o("li",null,[o("button",{onClick:s},"Commence !")])])]),_:1}))}}),bt=n=>(Ht("data-v-eafba394"),n=n(),Ot(),n),Ie={id:"container"},Le=bt(()=>o("div",{id:"toolbar"},null,-1)),Me={class:"hiddenAsset"},He={key:0,autoplay:""},Oe=bt(()=>o("source",{src:Tt,type:"audio/mpeg"},null,-1)),Te=[Oe],Ae=E({__name:"FullGame",props:{userImg:{}},setup(n){const t=x(),i=x(),s=x("100%"),a=x("100%"),h=x(),c=x(!1),p=x(!1);It(()=>{const l=t.value.width,f=l*(9/16);return{width:l,height:f}});function d(){const l=t.value.height-t.value.height*.15,f=l*(656/520);s.value=`${f}px`,a.value=`${l}px`}async function I(){await h.value.start(),c.value=!1,p.value=!1}async function vt(){const l=v(t),f=v(i),R=l.getContext("2d"),L=f.getContext("2d");h.value=new q(R,L),await h.value.start(),c.value=!1,p.value=!1}return Lt(()=>{const l=v(t),f=v(i),{innerWidth:R,innerHeight:L}=window;l.width=R,l.height=R*(9/16),f.width=R,f.height=L,d(),window.addEventListener("load",function(){c.value=!0,window.dispatchEvent(new CustomEvent("game-loaded"))}),window.addEventListener("game-resized",function(){d()}),window.addEventListener("game-ended",function(){p.value=!0});const yt=l.getContext("2d"),St=f.getContext("2d");h.value=new q(yt,St)}),(l,f)=>(w(),y("div",Ie,[o("canvas",{id:"collisionCanvas1",ref_key:"collisionCanvas1",ref:i},null,512),o("canvas",{id:"canvas1",ref_key:"canvas1",ref:t},null,512),Le,o("div",Me,[v(r).backgroundSound?(w(),y("audio",He,Te)):M("",!0)]),o("div",{ref:"agenda",class:"agenda-container",style:Mt({width:s.value,height:a.value})},[c.value?(w(),A(ke,{key:0,onStart:I})):M("",!0),p.value?(w(),A(Re,{key:1,onRestart:vt})):M("",!0)],4)]))}}),$e=V(Ae,[["__scopeId","data-v-eafba394"]]);export{$e as default};
